<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Verify - ChronoSeal</title>
  <link href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(to bottom right, #f5f7fa, #c3cfe2);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 1rem;
    }
    .box {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      max-width: 640px;
      margin: auto;
    }
    #canvas-wrapper {
      position: relative;
      width: 100%;
      overflow: hidden;
    }
    .image-preview {
      max-width: 100%;
      display: block;
      border-radius: 8px;
    }
    canvas {
      position: absolute;
      top: 0;
      left: 0;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      margin-top: 0.5rem;
    }
    .controls button {
      flex: 1 1 48%;
      margin-bottom: 0.5rem;
    }
    .help {
      font-size: 0.85rem;
      margin-top: 0.25rem;
    }
  </style>
</head>
<body>
  <section class="section">
    <div class="box">
      <h1 class="title is-4 has-text-centered">ðŸ”’ Verify Your Identity</h1>
      <form id="verifyForm" action="/verify" method="POST" enctype="multipart/form-data">
        <div class="field">
          <label class="label">Discord Username</label>
          <div class="control">
            <input class="input" type="text" name="username" required>
          </div>
        </div>
        <div class="field">
          <label class="label">Discord User ID</label>
          <div class="control">
            <input class="input" type="text" name="userId" required>
          </div>
          <p class="help">
            <strong>Desktop:</strong> User Settings â†’ Advanced â†’ Enable Developer Mode â†’ Right-click your profile â†’ Copy ID<br>
            <strong>Mobile:</strong> Tap your profile â†’ 3 dots (top right) â†’ Copy ID
          </p>
        </div>
        <div class="field">
          <label class="label">Birthday</label>
          <div class="control">
            <input class="input" type="date" name="birthdate" required>
          </div>
        </div>
        <div class="field">
          <label class="label">Upload Your ID</label>
          <div class="control">
            <input class="input" type="file" name="idImage" id="idImage" accept="image/*" required>
          </div>
          <div id="canvas-wrapper">
            <img id="idPreview" class="image-preview" alt="ID Preview">
            <canvas id="drawCanvas"></canvas>
          </div>
          <div class="controls">
            <button class="button is-danger" type="button" id="clearBtn">Clear</button>
            <button class="button is-warning" type="button" id="undoBtn">Undo</button>
            <button class="button is-info" type="button" id="zoomIn">Zoom In</button>
            <button class="button is-info" type="button" id="zoomOut">Zoom Out</button>
          </div>
        </div>
        <div class="field">
          <label class="label">Upload a Selfie</label>
          <div class="control">
            <input class="input" type="file" name="selfieImage" id="selfieImage" accept="image/*" required>
          </div>
          <img id="selfiePreview" class="image-preview" alt="Selfie Preview">
        </div>
        <div class="field mt-4">
          <div class="control">
            <button class="button is-success is-fullwidth" type="submit">âœ… Submit</button>
          </div>
        </div>
      </form>
    </div>
  </section>

  <script>
    const canvas = document.getElementById('drawCanvas');
    const ctx = canvas.getContext('2d');
    const previewImg = document.getElementById('idPreview');
    const fileInput = document.getElementById('idImage');
    const selfieInput = document.getElementById('selfieImage');
    const selfiePreview = document.getElementById('selfiePreview');
    const clearBtn = document.getElementById('clearBtn');
    const undoBtn = document.getElementById('undoBtn');
    const zoomInBtn = document.getElementById('zoomIn');
    const zoomOutBtn = document.getElementById('zoomOut');

    let drawing = false;
    let paths = [];
    let currentPath = [];
    let scale = 1;

    function resizeCanvas() {
      canvas.width = previewImg.clientWidth;
      canvas.height = previewImg.clientHeight;
      canvas.style.width = previewImg.clientWidth + "px";
      canvas.style.height = previewImg.clientHeight + "px";
      redraw();
    }

    function redraw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.strokeStyle = 'red';
      ctx.lineWidth = 5;
      for (const path of paths) {
        ctx.beginPath();
        for (let i = 0; i < path.length; i++) {
          const pt = path[i];
          if (i === 0) ctx.moveTo(pt.x, pt.y);
          else ctx.lineTo(pt.x, pt.y);
        }
        ctx.stroke();
      }
    }

    function getPos(e) {
      const rect = canvas.getBoundingClientRect();
      const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
      const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
      return { x, y };
    }

    function startDrawing(e) {
      drawing = true;
      currentPath = [getPos(e)];
    }

    function draw(e) {
      if (!drawing) return;
      currentPath.push(getPos(e));
      paths.push([...currentPath]);
      redraw();
    }

    function stopDrawing() {
      drawing = false;
    }

    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseout', stopDrawing);
    canvas.addEventListener('touchstart', startDrawing);
    canvas.addEventListener('touchmove', draw);
    canvas.addEventListener('touchend', stopDrawing);

    clearBtn.addEventListener('click', () => {
      paths = [];
      redraw();
    });

    undoBtn.addEventListener('click', () => {
      paths.pop();
      redraw();
    });

    zoomInBtn.addEventListener('click', () => {
      scale += 0.1;
      previewImg.style.transform = `scale(${scale})`;
      canvas.style.transform = `scale(${scale})`;
    });

    zoomOutBtn.addEventListener('click', () => {
      scale = Math.max(0.5, scale - 0.1);
      previewImg.style.transform = `scale(${scale})`;
      canvas.style.transform = `scale(${scale})`;
    });

    fileInput.addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = event => {
        previewImg.src = event.target.result;
        previewImg.onload = resizeCanvas;
      };
      reader.readAsDataURL(file);
    });

    selfieInput.addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = event => {
        selfiePreview.src = event.target.result;
      };
      reader.readAsDataURL(file);
    });
  </script>
</body>
</html>
