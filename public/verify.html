<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Verify - ChronoSeal</title>
  <link href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(to bottom right, #f0f0f0, #d6e4f0);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
    }
    .section {
      padding: 1rem;
    }
    .box {
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }
    .field {
      margin-bottom: 1rem;
    }
    canvas {
      position: absolute;
      top: 0;
      left: 0;
      border-radius: 8px;
      touch-action: none;
    }
    .image-preview {
      max-width: 100%;
      display: block;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    }
    .image-container {
      position: relative;
      width: 100%;
      margin-bottom: 1rem;
    }
    @media (max-width: 768px) {
      .box {
        padding: 1rem;
      }
    }
  </style>
</head>
<body>
  <section class="section">
    <div class="container">
      <div class="box">
        <h1 class="title is-4 has-text-centered">ðŸ”’ Verify Your Identity</h1>
        <form id="verifyForm" action="/verify" method="POST" enctype="multipart/form-data">
          <div class="field">
            <label class="label">Discord Username</label>
            <div class="control">
              <input class="input" type="text" name="username" required>
            </div>
          </div>

          <div class="field">
            <label class="label">Discord User ID</label>
            <div class="control">
              <input class="input" type="text" name="userId" required>
            </div>
            <p class="help">
              <strong>Desktop:</strong> User Settings â†’ Advanced â†’ Enable Developer Mode â†’ Right-click your profile â†’ Copy ID<br>
              <strong>Mobile:</strong> Tap profile â†’ 3 dots (top right) â†’ Copy ID
            </p>
          </div>

          <div class="field">
            <label class="label">Birthday</label>
            <div class="control">
              <input class="input" type="date" name="birthdate" required>
            </div>
          </div>

          <div class="field">
            <label class="label">Upload Your ID</label>
            <div class="control">
              <input class="input" type="file" name="idImage" id="idImage" accept="image/*" required>
            </div>
            <div class="image-container">
              <img id="idPreview" class="image-preview" alt="ID Preview">
              <canvas id="drawing-canvas"></canvas>
            </div>
            <button class="button is-danger mt-2" type="button" id="clearBtn">Clear Drawing</button>
          </div>

          <div class="field">
            <label class="label">Upload a Selfie</label>
            <div class="control">
              <input class="input" type="file" name="selfieImage" id="selfieImage" accept="image/*" required>
            </div>
            <img id="selfiePreview" class="image-preview" alt="Selfie Preview">
          </div>

          <div class="field mt-4">
            <div class="control">
              <button class="button is-primary is-fullwidth" type="submit">âœ… Submit</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </section>

  <script>
    const canvas = document.getElementById('drawing-canvas');
    const ctx = canvas.getContext('2d');
    const previewImg = document.getElementById('idPreview');
    const fileInput = document.getElementById('idImage');
    const selfieInput = document.getElementById('selfieImage');
    const selfiePreview = document.getElementById('selfiePreview');

    let drawing = false;
    let lastX, lastY;

    ctx.strokeStyle = 'red';
    ctx.lineWidth = 5;
    ctx.lineCap = 'round';

    function resizeCanvasToImage() {
      const rect = previewImg.getBoundingClientRect();
      canvas.style.width = rect.width + 'px';
      canvas.style.height = rect.height + 'px';
      canvas.width = rect.width;
      canvas.height = rect.height;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    window.addEventListener('resize', () => {
      if (previewImg.src) resizeCanvasToImage();
    });

    previewImg.onload = () => {
      resizeCanvasToImage();
    };

    fileInput.addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = event => {
        previewImg.src = event.target.result;
      };
      reader.readAsDataURL(file);
    });

    selfieInput.addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = event => {
        selfiePreview.src = event.target.result;
      };
      reader.readAsDataURL(file);
    });

    function getPos(evt) {
      const rect = canvas.getBoundingClientRect();
      const clientX = evt.touches ? evt.touches[0].clientX : evt.clientX;
      const clientY = evt.touches ? evt.touches[0].clientY : evt.clientY;
      return {
        x: clientX - rect.left,
        y: clientY - rect.top
      };
    }

    function startDraw(evt) {
      evt.preventDefault();
      const pos = getPos(evt);
      drawing = true;
      lastX = pos.x;
      lastY = pos.y;
    }

    function draw(evt) {
      if (!drawing) return;
      evt.preventDefault();
      const pos = getPos(evt);
      ctx.beginPath();
      ctx.moveTo(lastX, lastY);
      ctx.lineTo(pos.x, pos.y);
      ctx.stroke();
      lastX = pos.x;
      lastY = pos.y;
    }

    function stopDraw() {
      drawing = false;
    }

    canvas.addEventListener('mousedown', startDraw);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDraw);
    canvas.addEventListener('mouseout', stopDraw);

    canvas.addEventListener('touchstart', startDraw);
    canvas.addEventListener('touchmove', draw, { passive: false });
    canvas.addEventListener('touchend', stopDraw);

    document.getElementById('clearBtn').addEventListener('click', () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    });
  </script>
</body>
</html>
